#:kivy 2.1.0
#:import Factory kivy.factory.Factory

WindowManager:
    LoginWindow:
    HomeWindow: 
<ApplicationDropDown@DropDown>:
    
<CustomTextField@MDTextField>:
    hint_font_size: dp(30)
    font_size: dp(20) 
    pos_hint: {"center_x": 0.5, "center_y": 0.5}
    multiline: False
    mode: "rectangle"

    #Normal
    line_color_normal: 1, 1, 1, 1
    hint_text_color_normal: 1, 1, 1, 1
    text_color_normal: 1, 1, 1, 1

    #Active
    line_color_focus: 1, 1, 1, 1
    hint_text_color_focus: 1, 1, 1, 1
    text_color_focus: 1, 1, 1, 1

<BackgroundImage@Image>:
    source: "Images/Background.jpg"
    allow_stretch: True
    keep_ratio: False 

<PasswordLayout@RelativeLayout>:
    id: password_layout
    main_password: ""
    CustomTextField:
        id: password
        hint_text: "Password"
        text: root.main_password
        password: True

    MDIconButton:
        icon: "eye-off"
        pos_hint: {"center_x": 0.95, "center_y": 0.45}
        text_color: 1, 1, 1, 1
        theme_text_color: "Custom"
        on_release:
            self.icon = "eye" if self.icon == "eye-off" else "eye-off"
            password.password = False if password.password is True else True

<SettingsPopup@Popup>:
    id: Settings
    auto_dismiss: False 
    size_hint: 0.4, 0.5
    title: "Settings"
    bold: True
    title_size: dp(32)
    title_color: 1, 1, 1, 1
    title_align: "center"
    separator_color: 1, 1, 1, 0
    on_open: app.loadSettings()
    on_dismiss: app.loadSettings()

    MDBoxLayout:
        orientation: "vertical"
        padding: dp(40)
        spacing: dp(20)

        CustomTextField:
            id: root_username
            text: app.root_username
            hint_text: "Username"

        PasswordLayout:
            id: root_password
            main_password: app.root_password

        MDBoxLayout:
            MDRaisedButton:
                id: account_submit
                text: "Submit"
                font_size: dp(20)
                pos_hint: {"center_y": 0.5}
                on_release:
                    if app.saveSettings(root_username.text, root_password.ids.password.text) == True: root.dismiss()
                    
            AnchorLayout:
                anchor_x: "right"

                MDRaisedButton:
                    text: "Close"
                    font_size: dp(20)
                    color: "red"
                    on_release: root.dismiss()

<AccountCreatePopup@Popup>:
    auto_dismiss: False 
    size_hint: 0.4, 0.7
    title: "Store an Account"
    bold: True
    title_size: dp(32)
    title_color: 1, 1, 1, 1
    title_align: "center"
    separator_color: 1, 1, 1, 0

    MDBoxLayout:
        orientation: "vertical"
        padding: dp(40), dp(15)
        spacing: dp(20)

        CustomTextField:
            id: account_app
            hint_text: "Application (i.e Google, Steam, etc)"

        CustomTextField:
            id: account_username
            hint_text: "Username"

        CustomTextField:
            id: account_email
            hint_text: "Email"

        PasswordLayout:
            id: pw

        MDBoxLayout:
            MDRaisedButton:
                id: account_submit
                text: "Submit"
                font_size: dp(20)
                pos_hint: {"center_y": 0.5}
                on_release:
                    if app.createAccount(account_app.text, account_username.text, account_email.text, pw.ids.password.text) == True: root.dismiss()
                    
            AnchorLayout:
                anchor_x: "right"

                MDRaisedButton:
                    text: "Close"
                    font_size: dp(20)
                    color: "red"
                    on_release: root.dismiss()

<SearchPopup@Popup>:
    auto_dismiss: False
    size_hint: 0.4, 0.7
    title: "Search for an Account"
    bold: True
    title_size: dp(32)
    title_color: 1, 1, 1, 1
    title_align: "center"
    separator_color: 1, 1, 1, 0
    MDBoxLayout:
        orientation: "vertical"
        padding: dp(40), dp(15)
        spacing: dp(20)

        CustomTextField:
            id: account_app
            hint_text: "Application (i.e Google, Steam, etc)"

        CustomTextField:
            id: account_email
            hint_text: "Email"

        CustomTextField:
            id: account_username
            hint_text: "Username"

        PasswordLayout:
            id: account_password

        MDBoxLayout:
            MDRaisedButton:
                id: account_submit
                text: "Submit"
                font_size: dp(20)
                pos_hint: {"center_y": 0.5}
                on_release:
                    if app.createAccount(account_app.text, account_username.text, account_email.text, pw.ids.password.text) == True: root.dismiss()
                    
            AnchorLayout:
                anchor_x: "right"

                MDRaisedButton:
                    text: "Close"
                    font_size: dp(20)
                    color: "red"
                    on_release: root.dismiss()


<LoginWindow>:
    name: "login"

    BackgroundImage:

    MDAnchorLayout:
        anchor_x: "center"
        anchor_y: "center"

        MDCard:
            size_hint: 0.3, 0.3
            orientation: 'vertical'
            padding: dp(10)
            spacing: dp(25)
            background: "Images/Card_Background.png"

            CustomTextField:
                id: username
                hint_text: "Username"

            PasswordLayout:
                id: pw

            AnchorLayout:
                anchor_x: "center"
                anchor_y: "bottom"

                MDRaisedButton:
                    text: "Login"
                    md_bg_color: "#186cf0"
                    font_size: dp(24)
                    on_release: 
                        if root.validateLogin(username.text, pw.ids.password.text) == "True": \
                        root.manager.current = "home" 
                        root.manager.transition.direction = "left"

<HomeWindow>:
    name: "home"

    BackgroundImage:

    MDBoxLayout:
        orientation: "vertical"
        padding: dp(20)
        spacing: dp(20)

        MDBoxLayout:
            orientation: "horizontal"
            padding_x: dp(20)
            spacing: dp(20)

            MDCard:
                id: account_create
                orientation: "vertical"
                spacing: dp(20)
                on_release: Factory.AccountCreatePopup().open()
                background: "Images/Card_Background.png"

                AnchorLayout:
                    anchor_x: "left"
                    anchor_y: "top"
                    padding: dp(20)
                    size_hint: 0.1, 0.1
                    MDIconButton:
                        icon: "cog"
                        on_release:
                            Factory.SettingsPopup().open()

                MDBoxLayout:
                    orientation: "vertical"
                    padding: dp(125)
                    spacing: dp(40)
                    valign: "center"

                    MDIcon:
                        icon: "account-arrow-up"
                        font_size: dp(65)
                        pos_hint: {"center_x": 0.5}
                       
                    MDLabel:
                        text: "Create"
                        font_size: dp(30)
                        bold: True
                        halign: "center"
                    
                    
            MDCard:
                id: account_search
                orientation: "vertical"
                spacing: dp(20)
                padding: dp(100)
                background: "Images/Card_Background.png"

                MDIcon:
                    icon: "magnify"
                    font_size: dp(65)
                    pos_hint: {"center_x": 0.5}
                    halign: "center"

                MDLabel:
                    text: "Search"
                    font_size: dp(30)
                    bold: True
                    halign: "center"

        MDBoxLayout:
            orientation: "horizontal"
            padding_x: dp(20)
            spacing: dp(20)

            MDCard:
                id: account_edit
                orientation: "vertical"
                spacing: dp(20)
                padding: dp(100)
                background: "Images/Card_Background.png"

                MDIcon:
                    icon: "account-edit"
                    font_size: dp(65)
                    pos_hint: {"center_x": 0.5}
                    halign: "center"

                MDLabel:
                    text: "Edit"
                    font_size: dp(30)
                    bold: True
                    halign: "center"
                    
            MDCard:
                id: account_delete
                orientation: "vertical"
                spacing: dp(20)
                padding: dp(100)
                background: "Images/Card_Background.png"

                MDIcon:
                    icon: "delete-empty"
                    font_size: dp(65)
                    pos_hint: {"center_x": 0.5}
                    halign: "center"

                MDLabel:
                    text: "Delete"
                    font_size: dp(30)
                    bold: True
                    halign: "center"
        

